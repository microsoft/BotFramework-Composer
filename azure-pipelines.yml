trigger:
  - master

pr:
  autoCancel: true
  branches:
    include:
      - '*'

stages:
  - stage: build
    jobs:
      - job: buildAndPush
        displayName: Display and Push Docker Image
        steps:
          - task: Docker@2
            inputs:
              containerRegistry: 'bfc-docker-registry'
              repository: 'composer'
              command: 'buildAndPush'
              Dockerfile: 'Composer/Dockerfile.ci'
              buildContext: 'Composer/'

  # - stage: e2e
  #   jobs:
  #     - job: e2e
  #       strategy:
  #         parallel: 4
  #       pool:
  #         vmImage: ubuntu-latest

  #       steps:

  #         - script: |
  #             yarn start &
  #             npx cypress run --browser chrome --record --parallel --ci-build-id $BUILD_BUILDNUMBER --group "Azure CI"
  #           displayName: yarn test:integration
  #           workingDirectory: Composer
  #           continueOnError: true
  #           env:
  #             CYPRESS_RECORD_KEY: $(CYPRESS_RECORD_KEY)
  #             CYPRESS_VIDEO: true
  #             CYPRESS_VIDEO_UPLOAD_ON_PASSES: true
  #             # avoid warnings about terminal
  #             TERM: xterm
