# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:
  - job: install
    displayName: Install Dependencies
    pool:
      name: Hosted macOS
    steps:
    - task: NodeTool@0
      displayName: 'Use Node 10.15.3'
      inputs:
        versionSpec: 10.15.3
    - script: cd Composer && yarn install --network-concurrency 1
      displayName: 'yarn install'
  - job: build
    displayName: Build
    dependsOn: install
    pool:
      name: Hosted macOS
    steps:
    - script: cd Composer && yarn build
      displayName: 'yarn build'
  - job: lint
    displayName: Lint
    dependsOn: install
    pool:
      name: Hosted macOS
    steps:
    - script: cd Composer && yarn lint
      displayName: 'yarn lint'
  - job: test
    displayName: Test
    dependsOn: install
    pool:
      name: Hosted macOS
    steps:
    - script: cd Composer && yarn test:coverage
      displayName: 'yarn test:coverage'
      condition: succeededOrFailed()
    - task: PublishCodeCoverageResults@1
      displayName: 'Publish code coverage from Composer/coverage/cobertura-coverage.xml'
      inputs:
        codeCoverageTool: Cobertura
        summaryFileLocation: 'Composer/coverage/cobertura-coverage.xml'
        reportDirectory: 'Composer/coverage/lcov-report'